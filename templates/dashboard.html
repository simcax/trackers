{% extends "base.html" %}

{% block title %}My Trackers - Tracker Web UI{% endblock %}
{% block page_title %}My Trackers{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white">
    <!-- Dashboard Header -->
    <div class="w-full px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col space-y-4 sm:flex-row sm:justify-between sm:items-center sm:space-y-0 mb-6 sm:mb-8">
                <div class="text-center sm:text-left">
                    <h1 class="text-2xl sm:text-3xl font-bold text-white">
                        {% if current_user %}
                            {{ current_user.name }}'s Trackers
                        {% else %}
                            My Trackers
                        {% endif %}
                    </h1>
                    <p class="text-gray-400 mt-1 text-sm sm:text-base">Track your progress and achieve your goals</p>
                    {% if database_user %}
                        <p class="text-gray-500 text-xs mt-1">
                            {{ trackers|length }} tracker{{ 's' if trackers|length != 1 else '' }} total
                        </p>
                    {% endif %}
                </div>
                
                <!-- Create New Tracker Button -->
                <button 
                    id="create-tracker-btn"
                    class="w-full sm:w-auto bg-teal-500 hover:bg-teal-600 focus:ring-4 focus:ring-teal-300 font-medium rounded-lg text-sm px-6 py-3 text-white transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl min-touch-target focus-visible"
                    aria-label="Create a new tracker"
                    aria-describedby="create-tracker-help"
                    data-interactive="true"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span>Create New Tracker</span>
                </button>
                <div id="create-tracker-help" class="sr-only">Opens a form to create a new tracker for monitoring your progress</div>
            </div>
            
            <!-- Trackers Grid - Mobile First Responsive -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6" 
                 id="trackers-grid" 
                 role="region" 
                 aria-label="Your trackers"
                 aria-describedby="trackers-description">
                <div id="trackers-description" class="sr-only">
                    A list of your personal trackers showing current values, recent data, and trend information
                </div>
                {% if trackers %}
                    {% for tracker in trackers %}
                        {% include 'components/tracker_card.html' %}
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="col-span-full flex flex-col items-center justify-center py-12 sm:py-16 text-center px-4" 
                         role="region" 
                         aria-label="No trackers found">
                        <div class="w-20 h-20 sm:w-24 sm:h-24 bg-gray-800 rounded-full flex items-center justify-center mb-4 sm:mb-6" aria-hidden="true">
                            <svg class="w-10 h-10 sm:w-12 sm:h-12 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg sm:text-xl font-semibold text-gray-300 mb-2">
                            {% if current_user %}
                                Welcome, {{ current_user.name.split()[0] if current_user.name else 'there' }}!
                            {% else %}
                                No trackers yet
                            {% endif %}
                        </h3>
                        <p class="text-gray-500 mb-4 sm:mb-6 max-w-md text-sm sm:text-base">
                            {% if current_user %}
                                You haven't created any trackers yet. Get started by creating your first tracker to monitor your progress and achieve your goals.
                            {% else %}
                                Get started by creating your first tracker to monitor your progress and achieve your goals.
                            {% endif %}
                        </p>
                        <button 
                            class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-6 py-3 text-white transition-all duration-200 min-touch-target focus-visible"
                            onclick="document.getElementById('create-tracker-btn').click()"
                            aria-label="Create your first tracker"
                        >
                            Create Your First Tracker
                        </button>
                    </div>
                {% endif %}
            </div>
            
            <!-- Feedback System Demo (only show when no trackers exist) -->
            {% if not trackers %}
            <div class="mt-8 p-4 bg-gray-800 rounded-lg border border-gray-700">
                <h3 class="text-lg font-semibold text-white mb-4">Feedback System Demo</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                    <button 
                        id="demo-success-toast"
                        class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-white text-sm transition-colors min-touch-target focus-visible"
                    >
                        Success Toast
                    </button>
                    <button 
                        id="demo-error-toast"
                        class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg text-white text-sm transition-colors min-touch-target focus-visible"
                    >
                        Error Toast
                    </button>
                    <button 
                        id="demo-loading"
                        class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-white text-sm transition-colors min-touch-target focus-visible"
                    >
                        Loading Demo
                    </button>
                    <button 
                        id="demo-skeleton"
                        class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-white text-sm transition-colors min-touch-target focus-visible"
                    >
                        Skeleton Demo
                    </button>
                </div>
                <div id="demo-content" class="mt-4 p-4 bg-gray-700 rounded-lg">
                    <p class="text-gray-300">This is demo content that will be replaced with skeleton screens during loading demonstrations.</p>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- New Tracker Form Modal (Hidden by default) -->
    <div id="new-tracker-form" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden p-4" 
         role="dialog" 
         aria-labelledby="form-title" 
         aria-describedby="form-description"
         aria-modal="true"
         aria-hidden="true">
        <div class="bg-gray-800 rounded-xl p-4 sm:p-6 w-full max-w-md shadow-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4 sm:mb-6">
                <div>
                    <h2 id="form-title" class="text-lg sm:text-xl font-semibold text-white">Add New Tracker</h2>
                    <p id="form-description" class="text-sm text-gray-400 mt-1">Create a new tracker to monitor your progress</p>
                </div>
                <button 
                    id="close-form-btn"
                    class="text-gray-400 hover:text-white transition-colors p-1 min-touch-target focus-visible"
                    aria-label="Close form dialog"
                    type="button"
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Form will be included here -->
            {% include 'components/tracker_form.html' %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const createBtn = document.getElementById('create-tracker-btn');
    const formModal = document.getElementById('new-tracker-form');
    const closeBtn = document.getElementById('close-form-btn');
    
    // Show form modal
    createBtn.addEventListener('click', function() {
        formModal.classList.remove('hidden');
        formModal.setAttribute('aria-hidden', 'false');
        
        // Ensure form handler is initialized
        if (window.initializeTrackerFormHandler) {
            window.initializeTrackerFormHandler();
        }
        
        // Initialize form handler if available
        if (window.trackerFormHandler) {
            setTimeout(() => {
                window.trackerFormHandler.initializeForm();
            }, 100);
        }
        
        // Focus first input in form
        const firstInput = formModal.querySelector('input');
        if (firstInput) {
            setTimeout(() => firstInput.focus(), 200);
        }
    });
    
    // Hide form modal
    function hideForm() {
        formModal.classList.add('hidden');
        formModal.setAttribute('aria-hidden', 'true');
        createBtn.focus(); // Return focus to trigger button
    }
    
    closeBtn.addEventListener('click', hideForm);
    
    // Close on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && !formModal.classList.contains('hidden')) {
            hideForm();
        }
    });
    
    // Close on backdrop click
    formModal.addEventListener('click', function(e) {
        if (e.target === formModal) {
            hideForm();
        }
    });
    
    // Make hideForm globally available for form component
    window.hideTrackerForm = hideForm;
    
    // Feedback System Demo Event Listeners
    const successToastBtn = document.getElementById('demo-success-toast');
    const errorToastBtn = document.getElementById('demo-error-toast');
    const loadingBtn = document.getElementById('demo-loading');
    const skeletonBtn = document.getElementById('demo-skeleton');
    const demoContent = document.getElementById('demo-content');
    
    if (successToastBtn) {
        successToastBtn.addEventListener('click', function() {
            if (window.feedbackManager) {
                window.feedbackManager.showToast('This is a success message!', 'success');
            } else if (window.showToast) {
                window.showToast('This is a success message!', 'success');
            }
        });
    }
    
    if (errorToastBtn) {
        errorToastBtn.addEventListener('click', function() {
            if (window.feedbackManager) {
                window.feedbackManager.showToast('This is an error message!', 'error');
            } else if (window.showToast) {
                window.showToast('This is an error message!', 'error');
            }
        });
    }
    
    if (loadingBtn && demoContent) {
        loadingBtn.addEventListener('click', function() {
            if (window.feedbackManager) {
                // Show loading on the button itself
                window.feedbackManager.showLoading(loadingBtn, {
                    text: 'Processing...',
                    size: 'small'
                });
                
                // Hide loading after 3 seconds
                setTimeout(() => {
                    window.feedbackManager.hideLoading(loadingBtn);
                    window.feedbackManager.showToast('Loading complete!', 'success');
                }, 3000);
            } else if (window.showLoading) {
                window.showLoading();
                setTimeout(() => {
                    window.hideLoading();
                    if (window.showToast) {
                        window.showToast('Loading complete!', 'success');
                    }
                }, 3000);
            }
        });
    }
    
    if (skeletonBtn && demoContent) {
        skeletonBtn.addEventListener('click', function() {
            if (window.feedbackManager) {
                // Show skeleton screen
                window.feedbackManager.showSkeleton(demoContent, {
                    lines: 3,
                    height: '1rem',
                    spacing: '0.5rem',
                    animated: true
                });
                
                // Hide skeleton after 3 seconds
                setTimeout(() => {
                    window.feedbackManager.hideSkeleton(demoContent);
                    window.feedbackManager.showToast('Content loaded!', 'info');
                }, 3000);
            }
        });
    }
});
</script>
{% endblock %}