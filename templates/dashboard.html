{% extends "base.html" %}

{% block title %}My Trackers - Tracker Web UI{% endblock %}
{% block page_title %}My Trackers{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white">
    <!-- Dashboard Header -->
    <div class="w-full px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col space-y-4 sm:flex-row sm:justify-between sm:items-center sm:space-y-0 mb-6 sm:mb-8">
                <div class="text-center sm:text-left">
                    <h1 class="text-2xl sm:text-3xl font-bold text-white">
                        {% if current_user %}
                            {{ current_user.name }}'s Trackers
                        {% elif is_authenticated %}
                            My Trackers
                        {% else %}
                            My Trackers
                        {% endif %}
                    </h1>
                    <p class="text-gray-400 mt-1 text-sm sm:text-base">Track your progress and achieve your goals</p>
                    {% if database_user %}
                        <p class="text-gray-500 text-xs mt-1">
                            {{ trackers|length }} tracker{{ 's' if trackers|length != 1 else '' }} total
                        </p>
                    {% endif %}
                </div>
                
                <!-- Create New Tracker Button (only show for authenticated users) -->
                {% if is_authenticated %}
                <button 
                    id="create-tracker-btn"
                    class="w-full sm:w-auto bg-teal-500 hover:bg-teal-600 focus:ring-4 focus:ring-teal-300 font-medium rounded-lg text-sm px-6 py-3 text-white transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl min-touch-target focus-visible"
                    aria-label="Create a new tracker"
                    aria-describedby="create-tracker-help"
                    data-interactive="true"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    <span>Create New Tracker</span>
                </button>
                <div id="create-tracker-help" class="sr-only">Opens a form to create a new tracker for monitoring your progress</div>
                {% endif %}
            </div>
            
            <!-- Trackers Grid - Mobile First Responsive -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6" 
                 id="trackers-grid" 
                 role="region" 
                 aria-label="Your trackers"
                 aria-describedby="trackers-description">
                <div id="trackers-description" class="sr-only">
                    A list of your personal trackers showing current values, recent data, and trend information
                </div>
                {% if trackers %}
                    {% for tracker in trackers %}
                        {% include 'components/tracker_card.html' %}
                    {% endfor %}
                {% else %}
                    <!-- Empty State -->
                    <div class="col-span-full flex flex-col items-center justify-center py-12 sm:py-16 text-center px-4" 
                         role="region" 
                         aria-label="No trackers found">
                        <div class="w-20 h-20 sm:w-24 sm:h-24 bg-gray-800 rounded-full flex items-center justify-center mb-4 sm:mb-6" aria-hidden="true">
                            <svg class="w-10 h-10 sm:w-12 sm:h-12 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        
                        {% if is_authenticated %}
                            <!-- Authenticated user with no trackers -->
                            <h3 class="text-lg sm:text-xl font-semibold text-gray-300 mb-2">
                                Welcome{% if current_user %}, {{ current_user.name.split()[0] if current_user.name else 'there' }}{% endif %}!
                            </h3>
                            <p class="text-gray-500 mb-4 sm:mb-6 max-w-md text-sm sm:text-base">
                                You haven't created any trackers yet. Get started by creating your first tracker to monitor your progress and achieve your goals.
                            </p>
                            <button 
                                class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-6 py-3 text-white transition-all duration-200 min-touch-target focus-visible"
                                onclick="document.getElementById('create-tracker-btn').click()"
                                aria-label="Create your first tracker"
                            >
                                Create Your First Tracker
                            </button>
                        {% else %}
                            <!-- Unauthenticated user landing page -->
                            <h3 class="text-lg sm:text-xl font-semibold text-gray-300 mb-2">
                                Welcome to Trackers
                            </h3>
                            <p class="text-gray-500 mb-4 sm:mb-6 max-w-lg text-sm sm:text-base">
                                Track your habits, monitor your progress, and achieve your goals with our simple and powerful tracking application. 
                                Sign in with your Google account or create an account with email and password to start tracking immediately.
                            </p>
                            <div class="space-y-3 sm:space-y-0 sm:space-x-4 sm:flex sm:justify-center">
                                <a href="/auth/login" 
                                   class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-6 py-3 text-white transition-all duration-200 min-touch-target focus-visible inline-flex items-center justify-center space-x-2">
                                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                    <span>Sign In</span>
                                </a>
                                <a href="/web/learn-more" 
                                   class="w-full sm:w-auto bg-gray-600 hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-6 py-3 text-white transition-all duration-200 min-touch-target focus-visible inline-flex items-center justify-center">
                                    Learn More
                                </a>
                            </div>
                            
                            <!-- Feature highlights -->
                            <div class="mt-8 sm:mt-12 grid grid-cols-1 sm:grid-cols-3 gap-6 max-w-4xl">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <h4 class="text-sm font-semibold text-gray-300 mb-1">Easy Tracking</h4>
                                    <p class="text-xs text-gray-500">Create custom trackers for any metric you want to monitor</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                    </div>
                                    <h4 class="text-sm font-semibold text-gray-300 mb-1">Visual Progress</h4>
                                    <p class="text-xs text-gray-500">See your progress with beautiful charts and trends</p>
                                </div>
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                        </svg>
                                    </div>
                                    <h4 class="text-sm font-semibold text-gray-300 mb-1">Secure & Private</h4>
                                    <p class="text-xs text-gray-500">Your data is secure and only accessible to you</p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- New Tracker Form Modal (Hidden by default) -->
    <div id="new-tracker-form" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden p-4" 
         role="dialog" 
         aria-labelledby="form-title" 
         aria-describedby="form-description"
         aria-modal="true"
         aria-hidden="true">
        <div class="bg-gray-800 rounded-xl p-4 sm:p-6 w-full max-w-md shadow-2xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4 sm:mb-6">
                <div>
                    <h2 id="form-title" class="text-lg sm:text-xl font-semibold text-white">Add New Tracker</h2>
                    <p id="form-description" class="text-sm text-gray-400 mt-1">Create a new tracker to monitor your progress</p>
                </div>
                <button 
                    id="close-form-btn"
                    class="text-gray-400 hover:text-white transition-colors p-1 min-touch-target focus-visible"
                    aria-label="Close form dialog"
                    type="button"
                >
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Form will be included here -->
            {% include 'components/tracker_form.html' %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const createBtn = document.getElementById('create-tracker-btn');
    const formModal = document.getElementById('new-tracker-form');
    const closeBtn = document.getElementById('close-form-btn');
    
    // Only set up form functionality if user is authenticated and elements exist
    if (createBtn && formModal && closeBtn) {
        // Show form modal
        createBtn.addEventListener('click', function() {
            formModal.classList.remove('hidden');
            formModal.setAttribute('aria-hidden', 'false');
            
            // Ensure form handler is initialized
            if (window.initializeTrackerFormHandler) {
                window.initializeTrackerFormHandler();
            }
            
            // Initialize form handler if available
            if (window.trackerFormHandler) {
                setTimeout(() => {
                    window.trackerFormHandler.initializeForm();
                }, 100);
            }
            
            // Focus first input in form
            const firstInput = formModal.querySelector('input');
            if (firstInput) {
                setTimeout(() => firstInput.focus(), 200);
            }
        });
        
        // Hide form modal
        function hideForm() {
            formModal.classList.add('hidden');
            formModal.setAttribute('aria-hidden', 'true');
            createBtn.focus(); // Return focus to trigger button
        }
        
        closeBtn.addEventListener('click', hideForm);
        
        // Close on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !formModal.classList.contains('hidden')) {
                hideForm();
            }
        });
        
        // Close on backdrop click
        formModal.addEventListener('click', function(e) {
            if (e.target === formModal) {
                hideForm();
            }
        });
        
        // Make hideForm globally available for form component
        window.hideTrackerForm = hideForm;
    }
});
</script>
{% endblock %}